# Scripts Directory

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã€WordPress AWSç’°å¢ƒã®è‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ä½¿ç”¨ã‚·ãƒ¼ãƒ³ã”ã¨ã«ãƒ•ã‚©ãƒ«ãƒ€åˆ†ã‘ã•ã‚Œã¦ã„ã¾ã™ã€‚

## ğŸ“ ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ

scripts/
â”œâ”€â”€ setup/                    # åˆæœŸè¨­å®šã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ terraform_config.sh   # Terraformè¨­å®šç®¡ç†
â”‚   â””â”€â”€ setup_deployment.sh   # ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆç’°å¢ƒåˆæœŸè¨­å®š
â”œâ”€â”€ deployment/               # ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ prepare_validation.sh # æ¤œè¨¼ç’°å¢ƒæº–å‚™
â”‚   â”œâ”€â”€ deploy_to_production.sh # æœ¬ç•ªç’°å¢ƒåæ˜ 
â”‚   â””â”€â”€ auto_deployment.sh   # è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ
â”œâ”€â”€ maintenance/              # ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ update_ssh_cidr_env.sh # SSHè¨±å¯IPæ›´æ–°
â”‚   â””â”€â”€ rollback.sh          # ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
â””â”€â”€ README.md                # è©³ç´°ãªèª¬æ˜æ›¸

### ğŸ—ï¸ setup/ - åˆæœŸè¨­å®šã‚¹ã‚¯ãƒªãƒ—ãƒˆ
Terraform plan/applyå‰ã«å®Ÿè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

### ğŸ”„ deployment/ - ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
é‹ç”¨ä¸­ã«å®Ÿè¡Œã™ã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆé–¢é€£ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

### ğŸ”§ maintenance/ - ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
é‹ç”¨ä¸­ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä½œæ¥­ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

## ğŸ—ï¸ setup/ - åˆæœŸè¨­å®šã‚¹ã‚¯ãƒªãƒ—ãƒˆ

### terraform_config.sh
**ä½¿ç”¨ã‚·ãƒ¼ãƒ³**: æ–°è¦ç’°å¢ƒæ§‹ç¯‰æ™‚ã€è¨­å®šå¤‰æ›´æ™‚
**ä½¿ç”¨ç”¨é€”**: Terraformè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆãƒ»æ›´æ–°
**å‹•ä½œè§£èª¬**:
- å¯¾è©±å½¢å¼ã§ãƒ‰ãƒ¡ã‚¤ãƒ³åã€ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆæ—¥ä»˜ã€SSHè¨±å¯IPã€æ¤œè¨¼ç’°å¢ƒè¨­å®šã€ç™»éŒ²è€…æƒ…å ±ã‚’å…¥åŠ›
- æ—¢å­˜ãƒ‰ãƒ¡ã‚¤ãƒ³ã®è‡ªå‹•æ¤œå‡ºï¼ˆTerraform state + AWS CLIï¼‰
- `terraform.tfvars`ã¨`deployment_config.json`ã®ç”Ÿæˆ
- ãƒ‰ãƒ¡ã‚¤ãƒ³ç™»éŒ²ã®ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆy/Nï¼‰

**ä½¿ç”¨æ–¹æ³•**:
```bash
# æ–°è¦è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
./setup/terraform_config.sh

# æ—¢å­˜è¨­å®šã®æ›´æ–°
./setup/terraform_config.sh --update-only
```

**æ³¨æ„ç‚¹**:
- ãƒ‰ãƒ¡ã‚¤ãƒ³ç™»éŒ²ã«ã¯æ–™é‡‘ãŒç™ºç”Ÿï¼ˆå¹´é–“ç´„$12-15ï¼‰
- æœ¬ç•ªç’°å¢ƒã§ã¯SSHè¨±å¯IPã‚’ç‰¹å®šIPã«åˆ¶é™ã™ã‚‹ã“ã¨

### setup_deployment.sh
**ä½¿ç”¨ã‚·ãƒ¼ãƒ³**: ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆç’°å¢ƒã®åˆæœŸè¨­å®šæ™‚
**ä½¿ç”¨ç”¨é€”**: ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸè¨­å®š
**å‹•ä½œè§£èª¬**:
- å¿…è¦ãªãƒ„ãƒ¼ãƒ«ï¼ˆjqã€AWS CLIã€MySQLï¼‰ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- SSHéµã®è¨­å®š
- AWSèªè¨¼æƒ…å ±ã®ç¢ºèª
- ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œæ¨©é™ä»˜ä¸

**ä½¿ç”¨æ–¹æ³•**:
```bash
./setup/setup_deployment.sh
```

**æ³¨æ„ç‚¹**:
- åˆå›å®Ÿè¡Œæ™‚ã®ã¿å¿…è¦
- sudoæ¨©é™ãŒå¿…è¦ãªå ´åˆãŒã‚ã‚‹

## ğŸ”„ deployment/ - ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

### prepare_validation.sh
**ä½¿ç”¨ã‚·ãƒ¼ãƒ³**: è¨˜äº‹æ›´æ–°ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ›´æ–°ã€ãƒ†ãƒ¼ãƒå¤‰æ›´å‰
**ä½¿ç”¨ç”¨é€”**: æ¤œè¨¼ç’°å¢ƒã®æº–å‚™
**å‹•ä½œè§£èª¬**:
- æœ¬ç•ªç’°å¢ƒã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä½œæˆ
- æ¤œè¨¼ç”¨EC2/RDSã®èµ·å‹•
- æ¤œè¨¼ç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- æœ¬ç•ªç’°å¢ƒã¸ã®å½±éŸ¿ãªã—

**ä½¿ç”¨æ–¹æ³•**:
```bash
./deployment/prepare_validation.sh
```

**æ³¨æ„ç‚¹**:
- æ¤œè¨¼ç’°å¢ƒã®èµ·å‹•ã«ã¯ã‚³ã‚¹ãƒˆãŒç™ºç”Ÿ
- ãƒ†ã‚¹ãƒˆå®Œäº†å¾Œã¯æ¤œè¨¼ç’°å¢ƒã‚’åœæ­¢ã™ã‚‹ã“ã¨

### deploy_to_production.sh
**ä½¿ç”¨ã‚·ãƒ¼ãƒ³**: æ¤œè¨¼ç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆå®Œäº†å¾Œ
**ä½¿ç”¨ç”¨é€”**: æœ¬ç•ªç’°å¢ƒã¸ã®åæ˜ 
**å‹•ä½œè§£èª¬**:
- æ¤œè¨¼ç’°å¢ƒã®çŠ¶æ…‹ç¢ºèª
- æœ¬ç•ªç’°å¢ƒã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ
- æ¤œè¨¼ç’°å¢ƒã‹ã‚‰æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ¼ã‚¿åŒæœŸ
- æœ¬ç•ªç’°å¢ƒã®å‹•ä½œç¢ºèª
- æ¤œè¨¼ç’°å¢ƒã®åœæ­¢

**ä½¿ç”¨æ–¹æ³•**:
```bash
./deployment/deploy_to_production.sh
```

**æ³¨æ„ç‚¹**:
- æœ¬ç•ªç’°å¢ƒãŒä¸€æ™‚çš„ã«åœæ­¢ã™ã‚‹å¯èƒ½æ€§
- å¿…ãšæ¤œè¨¼ç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆå®Œäº†å¾Œã«å®Ÿè¡Œ

### auto_deployment.sh
**ä½¿ç”¨ã‚·ãƒ¼ãƒ³**: ä¸€é€£ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆä½œæ¥­ã®è‡ªå‹•åŒ–
**ä½¿ç”¨ç”¨é€”**: æ¤œè¨¼ç’°å¢ƒæº–å‚™ã‹ã‚‰æœ¬ç•ªåæ˜ ã¾ã§ã®è‡ªå‹•åŒ–
**å‹•ä½œè§£èª¬**:
- `prepare_validation.sh`ã®å®Ÿè¡Œ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèª
- `deploy_to_production.sh`ã®å®Ÿè¡Œ
- å®Œäº†ç¢ºèª

**ä½¿ç”¨æ–¹æ³•**:
```bash
./deployment/auto_deployment.sh
```

**æ³¨æ„ç‚¹**:
- é€”ä¸­ã§ç¢ºèªãŒå¿…è¦ãªå ´åˆã¯åœæ­¢
- ã™ã¹ã¦ã®ä½œæ¥­ãŒãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã‚‹

## ğŸ”§ maintenance/ - ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

### update_ssh_cidr_env.sh
**ä½¿ç”¨ã‚·ãƒ¼ãƒ³**: SSHè¨±å¯IPã®å¤‰æ›´æ™‚
**ä½¿ç”¨ç”¨é€”**: SSHæ¥ç¶šè¨±å¯IPã®æ›´æ–°
**å‹•ä½œè§£èª¬**:
- ç’°å¢ƒå¤‰æ•°`SSH_ALLOWED_IP`ã‹ã‚‰IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—
- CIDRå½¢å¼ã«å¤‰æ›
- `terraform.tfvars`ã®æ›´æ–°
- Terraform planã®å®Ÿè¡Œ

**ä½¿ç”¨æ–¹æ³•**:
```bash
export SSH_ALLOWED_IP=your.ip.address.here
./maintenance/update_ssh_cidr_env.sh
```

**æ³¨æ„ç‚¹**:
- ç’°å¢ƒå¤‰æ•°ã®è¨­å®šãŒå¿…è¦
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã®ãŸã‚ç‰¹å®šIPã«åˆ¶é™ã™ã‚‹ã“ã¨

### rollback.sh
**ä½¿ç”¨ã‚·ãƒ¼ãƒ³**: ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆå¤±æ•—æ™‚ã€ç·Šæ€¥æ™‚
**ä½¿ç”¨ç”¨é€”**: æœ¬ç•ªç’°å¢ƒã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
**å‹•ä½œè§£èª¬**:
- æœ€æ–°ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®è‡ªå‹•æ¤œå‡º
- æœ¬ç•ªç’°å¢ƒã®åœæ­¢
- ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‹ã‚‰ã®å¾©å…ƒ
- WordPressãƒ•ã‚¡ã‚¤ãƒ«ã®å¾©å…ƒ
- å‹•ä½œç¢ºèª

**ä½¿ç”¨æ–¹æ³•**:
```bash
./maintenance/rollback.sh
```

**æ³¨æ„ç‚¹**:
- æœ¬ç•ªç’°å¢ƒãŒä¸€æ™‚çš„ã«åœæ­¢
- æœ€æ–°ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ä½¿ç”¨
- ç·Šæ€¥æ™‚ä»¥å¤–ã¯ä½¿ç”¨ã‚’é¿ã‘ã‚‹

## ğŸ“‹ é‹ç”¨ãƒ•ãƒ­ãƒ¼

### åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
```bash
# 1. åˆæœŸè¨­å®š
./setup/terraform_config.sh
./setup/setup_deployment.sh

# 2. Terraformå®Ÿè¡Œ
terraform plan
terraform apply

# 3. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°
# deployment_config.jsonã®å€¤ã‚’è¨­å®š
```

### æ—¥å¸¸çš„ãªé‹ç”¨
```bash
# 1. æ¤œè¨¼ç’°å¢ƒã®æº–å‚™
./deployment/prepare_validation.sh

# 2. æ¤œè¨¼ç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆ
# ãƒ–ãƒ©ã‚¦ã‚¶ã§æ¤œè¨¼ç’°å¢ƒã«ã‚¢ã‚¯ã‚»ã‚¹

# 3. æœ¬ç•ªç’°å¢ƒã¸ã®åæ˜ 
./deployment/deploy_to_production.sh

# 4. ç·Šæ€¥æ™‚ã®ã¿ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
./maintenance/rollback.sh
```

### è‡ªå‹•åŒ–ã•ã‚ŒãŸé‹ç”¨
```bash
# ä¸€é€£ã®ä½œæ¥­ã‚’è‡ªå‹•åŒ–
./deployment/auto_deployment.sh
```

## âš ï¸ æ³¨æ„äº‹é …

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- æœ¬ç•ªç’°å¢ƒã§ã¯å¿…ãšSSHè¨±å¯IPã‚’ç‰¹å®šIPã«åˆ¶é™
- AWSèªè¨¼æƒ…å ±ã®é©åˆ‡ãªç®¡ç†
- æœ€å°æ¨©é™ã®åŸå‰‡ã«å¾“ã£ãŸIAMè¨­å®š

### ã‚³ã‚¹ãƒˆç®¡ç†
- æ¤œè¨¼ç’°å¢ƒã¯ä½¿ç”¨å¾Œã«åœæ­¢
- ä¸è¦ãªãƒªã‚½ãƒ¼ã‚¹ã®å®šæœŸçš„ãªç¢ºèª
- ãƒ‰ãƒ¡ã‚¤ãƒ³ç™»éŒ²æ–™é‡‘ã®ç¶™ç¶šç™ºç”Ÿã«æ³¨æ„

### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆå‰ã®è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®å®šæœŸçš„ãªç¢ºèª
- ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

#### AWSèªè¨¼æƒ…å ±ã‚¨ãƒ©ãƒ¼
```bash
aws sts get-caller-identity
aws configure
```

#### SSHæ¥ç¶šã‚¨ãƒ©ãƒ¼
```bash
ls -la ~/.ssh/id_rsa
terraform output -raw ssh_private_key > ~/.ssh/id_rsa
chmod 600 ~/.ssh/id_rsa
```

#### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼
```bash
cat deployment_config.json
./setup/terraform_config.sh
```

#### æ¨©é™ã‚¨ãƒ©ãƒ¼
```bash
chmod +x scripts/*/*.sh
```

---

*ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯éšæ™‚æ›´æ–°ã•ã‚Œã¾ã™ã€‚æœ€æ–°ç‰ˆã‚’ç¢ºèªã—ã¦ã‹ã‚‰ä½œæ¥­ã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚* 